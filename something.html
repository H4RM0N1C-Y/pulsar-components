<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Editor - Exact Replica</title>
    <style>
        /* === CSS RESET & BASE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            /* Notion's exact color palette */
            --notion-gray0: #ffffff;
            --notion-gray1: #f7f6f3;
            --notion-gray2: #f1f1ef;
            --notion-gray3: #e9e9e6;
            --notion-gray4: #e3e2e0;
            --notion-gray5: #dbdad7;
            --notion-gray6: #cfceca;
            --notion-gray7: #a9a8a5;
            --notion-gray8: #8f8e8a;
            --notion-gray9: #7a7975;
            --notion-gray10: #6a6965;
            --notion-gray11: #5a5955;
            --notion-gray12: #424240;
            --notion-gray13: #2a2a27;
            --notion-gray14: #1a1a18;
            
            --notion-red: #e03e3e;
            --notion-pink: #d6409f;
            --notion-blue: #0b6e99;
            --notion-purple: #6940a5;
            --notion-teal: #0f7b6c;
            --notion-yellow: #dfab01;
            --notion-orange: #d9730d;
            --notion-brown: #64473a;
            
            --notion-red-background: #fdebec;
            --notion-pink-background: #fceff7;
            --notion-blue-background: #e7f2f8;
            --notion-purple-background: #f4f0f9;
            --notion-teal-background: #e7f4f1;
            --notion-yellow-background: #fbf3db;
            --notion-orange-background: #fceedb;
            --notion-brown-background: #f5f0ed;
            --notion-gray-background: #f1f1ef;
            
            --notion-red-text: #d43939;
            --notion-pink-text: #c9368c;
            --notion-blue-text: #0a5e84;
            --notion-purple-text: #5e3691;
            --notion-teal-text: #0c6a5c;
            --notion-yellow-text: #c79a00;
            --notion-orange-text: #c16601;
            --notion-brown-text: #594339;
            
            --notion-icon: #8f8e8a;
            --notion-icon-hover: #5a5955;
            --notion-border: #e9e9e6;
            --notion-border-hover: #dbdad7;
            --notion-shadow: rgba(15, 15, 15, 0.05);
            --notion-shadow-hover: rgba(15, 15, 15, 0.1);
            --notion-selection: rgba(0, 122, 255, 0.1);
            
            --notion-font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
            --notion-code-font: "SF Mono", Monaco, "Cascadia Mono", "Roboto Mono", Menlo, Consolas, monospace;
            
            --notion-radius: 3px;
            --notion-radius-sm: 2px;
            --notion-radius-md: 4px;
            --notion-radius-lg: 6px;
            
            --notion-transition-fast: 100ms;
            --notion-transition: 200ms;
            --notion-transition-slow: 300ms;
            
            --notion-spacing-xs: 2px;
            --notion-spacing-sm: 4px;
            --notion-spacing-md: 8px;
            --notion-spacing-lg: 12px;
            --notion-spacing-xl: 16px;
            --notion-spacing-2xl: 20px;
            --notion-spacing-3xl: 24px;
            --notion-spacing-4xl: 32px;
            --notion-spacing-5xl: 40px;
            --notion-spacing-6xl: 48px;
        }

        body {
            font-family: var(--notion-font-family);
            color: var(--notion-gray12);
            background-color: var(--notion-gray0);
            font-size: 16px;
            line-height: 1.5;
            letter-spacing: -0.003em;
        }

        /* === NOTION APP LAYOUT === */
        .notion-app {
            display: flex;
            min-height: 100vh;
            background-color: var(--notion-gray0);
        }

        /* === SIDEBAR === */
        .notion-sidebar {
            width: 240px;
            background-color: var(--notion-gray1);
            border-right: 1px solid var(--notion-border);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            padding: var(--notion-spacing-xl) var(--notion-spacing-lg);
            z-index: 100;
            transition: transform var(--notion-transition) ease;
        }

        .notion-sidebar-header {
            padding-bottom: var(--notion-spacing-lg);
            margin-bottom: var(--notion-spacing-lg);
            border-bottom: 1px solid var(--notion-border);
        }

        .notion-sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--notion-gray9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--notion-spacing-md);
        }

        .notion-sidebar-item {
            display: flex;
            align-items: center;
            padding: var(--notion-spacing-sm) var(--notion-spacing-md);
            border-radius: var(--notion-radius);
            cursor: pointer;
            transition: all var(--notion-transition-fast) ease;
            margin-bottom: 1px;
            font-size: 14px;
            color: var(--notion-gray11);
            text-decoration: none;
            user-select: none;
        }

        .notion-sidebar-item:hover {
            background-color: var(--notion-gray2);
        }

        .notion-sidebar-item.active {
            background-color: var(--notion-gray3);
            color: var(--notion-gray12);
            font-weight: 500;
        }

        .notion-sidebar-icon {
            margin-right: var(--notion-spacing-md);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            color: var(--notion-icon);
            opacity: 0.9;
        }

        .notion-sidebar-divider {
            height: 1px;
            background-color: var(--notion-border);
            margin: var(--notion-spacing-lg) 0;
        }

        /* === MAIN CONTENT === */
        .notion-main {
            flex: 1;
            margin-left: 240px;
            min-height: 100vh;
            position: relative;
        }

        .notion-content {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--notion-spacing-5xl) var(--notion-spacing-4xl);
        }

        /* === PAGE HEADER === */
        .notion-page-header {
            margin-bottom: var(--notion-spacing-4xl);
        }

        .notion-page-icon {
            width: 78px;
            height: 78px;
            font-size: 78px;
            line-height: 1;
            margin-bottom: var(--notion-spacing-xl);
            color: var(--notion-gray8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--notion-radius-md);
            background-color: var(--notion-gray2);
            user-select: none;
            cursor: pointer;
            transition: background-color var(--notion-transition-fast) ease;
        }

        .notion-page-icon:hover {
            background-color: var(--notion-gray3);
        }

        .notion-page-title {
            font-size: 40px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: var(--notion-spacing-md);
            outline: none;
            border: none;
            background: transparent;
            width: 100%;
            color: var(--notion-gray14);
            resize: none;
            overflow: hidden;
            min-height: 48px;
            padding: 0;
            font-family: inherit;
            letter-spacing: -0.02em;
        }

        .notion-page-title::placeholder {
            color: var(--notion-gray8);
            opacity: 0.5;
        }

        /* === EDITOR BLOCKS === */
        .notion-editor {
            position: relative;
        }

        .notion-block {
            position: relative;
            margin: 1px 0;
            min-height: calc(1.5em + 8px);
            display: flex;
            align-items: flex-start;
            padding: 4px 2px;
            border-radius: var(--notion-radius-sm);
            transition: background-color var(--notion-transition-fast) ease;
        }

        .notion-block:hover {
            background-color: var(--notion-gray1);
        }

        .notion-block.selected {
            background-color: var(--notion-selection);
        }

        .notion-block.dragging {
            opacity: 0.5;
        }

        /* Block Handle */
        .notion-block-handle {
            position: absolute;
            left: -26px;
            top: 4px;
            width: 16px;
            height: 16px;
            opacity: 0;
            transition: opacity var(--notion-transition-fast) ease;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--notion-icon);
            border-radius: var(--notion-radius-sm);
            padding: 0;
            border: none;
            background: transparent;
            font-size: 16px;
            line-height: 1;
        }

        .notion-block:hover .notion-block-handle {
            opacity: 0.3;
        }

        .notion-block-handle:hover {
            opacity: 1 !important;
            background-color: var(--notion-gray2);
        }

        .notion-block-handle:active {
            cursor: grabbing;
        }

        /* Block Content Area */
        .notion-block-content {
            flex: 1;
            padding: 2px 0;
            min-height: 24px;
            outline: none;
            border: none;
            background: transparent;
            resize: none;
            font-size: 16px;
            line-height: 1.5;
            color: var(--notion-gray12);
            width: 100%;
            font-family: inherit;
            letter-spacing: -0.003em;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .notion-block-content[contenteditable="true"]:empty:before {
            content: attr(data-placeholder);
            color: var(--notion-gray8);
            opacity: 0.5;
            pointer-events: none;
        }

        .notion-block-content[contenteditable="true"]:focus {
            outline: none;
        }

        /* Block Actions Menu */
        .notion-block-actions {
            position: absolute;
            right: -36px;
            top: 2px;
            opacity: 0;
            transition: opacity var(--notion-transition-fast) ease;
            display: flex;
            gap: 1px;
            background-color: var(--notion-gray0);
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            padding: 2px;
            box-shadow: 0 2px 6px var(--notion-shadow);
            z-index: 10;
        }

        .notion-block:hover .notion-block-actions {
            opacity: 1;
        }

        .notion-block-action {
            width: 22px;
            height: 22px;
            border-radius: var(--notion-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--notion-icon);
            transition: all var(--notion-transition-fast) ease;
            background: transparent;
            border: none;
            font-size: 14px;
        }

        .notion-block-action:hover {
            background-color: var(--notion-gray2);
            color: var(--notion-icon-hover);
        }

        /* === BLOCK TYPES === */
        /* Text Block */
        .notion-block-text .notion-block-content {
            font-size: 16px;
            line-height: 1.5;
        }

        /* Heading Blocks */
        .notion-block-h1 .notion-block-content {
            font-size: 30px;
            font-weight: 700;
            line-height: 1.2;
            padding: 3px 0;
            letter-spacing: -0.02em;
        }

        .notion-block-h2 .notion-block-content {
            font-size: 24px;
            font-weight: 600;
            line-height: 1.3;
            padding: 3px 0;
            letter-spacing: -0.02em;
        }

        .notion-block-h3 .notion-block-content {
            font-size: 20px;
            font-weight: 600;
            line-height: 1.3;
            padding: 2px 0;
            letter-spacing: -0.015em;
        }

        /* List Blocks */
        .notion-block-bulleted {
            padding-left: 24px;
        }

        .notion-block-bulleted::before {
            content: "‚Ä¢";
            position: absolute;
            left: 8px;
            top: 4px;
            color: var(--notion-gray8);
            font-size: 18px;
            line-height: 1.5;
        }

        .notion-block-numbered {
            padding-left: 30px;
            counter-increment: notion-list;
        }

        .notion-block-numbered::before {
            content: counter(notion-list) ".";
            position: absolute;
            left: 8px;
            top: 4px;
            color: var(--notion-gray8);
            font-size: 16px;
            line-height: 1.5;
            min-width: 20px;
            text-align: right;
        }

        /* To-do Blocks */
        .notion-block-todo {
            display: flex;
            align-items: flex-start;
            gap: var(--notion-spacing-md);
        }

        .notion-todo-checkbox {
            width: 16px;
            height: 16px;
            border-radius: var(--notion-radius-sm);
            border: 1.5px solid var(--notion-gray7);
            margin-top: 4px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all var(--notion-transition-fast) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--notion-gray0);
            position: relative;
        }

        .notion-todo-checkbox:hover {
            border-color: var(--notion-gray8);
            background-color: var(--notion-gray1);
        }

        .notion-todo-checkbox.checked {
            background-color: var(--notion-teal);
            border-color: var(--notion-teal);
        }

        .notion-todo-checkbox.checked::after {
            content: "";
            position: absolute;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            margin-top: -1px;
        }

        .notion-block-todo.checked .notion-block-content {
            text-decoration: line-through;
            color: var(--notion-gray8);
        }

        /* Toggle Blocks */
        .notion-block-toggle {
            display: flex;
            flex-direction: column;
        }

        .notion-toggle-header {
            display: flex;
            align-items: flex-start;
            gap: var(--notion-spacing-md);
            cursor: pointer;
            user-select: none;
        }

        .notion-toggle-icon {
            width: 16px;
            height: 16px;
            margin-top: 4px;
            flex-shrink: 0;
            transition: transform var(--notion-transition-fast) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--notion-icon);
            transform: rotate(0deg);
        }

        .notion-toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .notion-toggle-content {
            margin-left: 24px;
            margin-top: var(--notion-spacing-sm);
            overflow: hidden;
        }

        .notion-toggle-content.collapsed {
            display: none;
        }

        /* Code Blocks */
        .notion-block-code {
            background-color: var(--notion-gray2);
            border-radius: var(--notion-radius);
            padding: var(--notion-spacing-xl);
            margin: var(--notion-spacing-md) 0;
            font-family: var(--notion-code-font);
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
        }

        .notion-code-language {
            position: absolute;
            top: var(--notion-spacing-md);
            right: var(--notion-spacing-md);
            font-size: 12px;
            color: var(--notion-gray8);
            background-color: var(--notion-gray1);
            padding: 2px 8px;
            border-radius: var(--notion-radius-sm);
            user-select: none;
        }

        .notion-block-code .notion-block-content {
            font-family: var(--notion-code-font);
            font-size: 14px;
            tab-size: 2;
            color: var(--notion-gray13);
        }

        /* Quote Blocks */
        .notion-block-quote {
            border-left: 3px solid var(--notion-gray4);
            padding-left: var(--notion-spacing-xl);
            color: var(--notion-gray11);
            font-style: italic;
            margin: var(--notion-spacing-md) 0;
        }

        /* Callout Blocks */
        .notion-block-callout {
            background-color: var(--notion-blue-background);
            border-radius: var(--notion-radius);
            padding: var(--notion-spacing-xl);
            margin: var(--notion-spacing-md) 0;
            display: flex;
            align-items: flex-start;
            gap: var(--notion-spacing-xl);
            border: 1px solid transparent;
        }

        .notion-callout-icon {
            font-size: 20px;
            color: var(--notion-blue);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Divider Block */
        .notion-block-divider {
            height: 1px;
            background-color: var(--notion-border);
            margin: var(--notion-spacing-xl) 0;
            width: 100%;
        }

        /* === FORMATTING TOOLBAR === */
        .notion-toolbar {
            position: absolute;
            background-color: var(--notion-gray0);
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            padding: 4px;
            box-shadow: 0 4px 12px var(--notion-shadow-hover);
            display: none;
            flex-wrap: wrap;
            gap: 2px;
            width: max-content;
            max-width: 400px;
            z-index: 1000;
            animation: notion-toolbar-fade-in 150ms ease;
        }

        @keyframes notion-toolbar-fade-in {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notion-toolbar-group {
            display: flex;
            border-right: 1px solid var(--notion-border);
            padding-right: 4px;
            margin-right: 4px;
        }

        .notion-toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
            padding-right: 0;
        }

        .notion-toolbar-button {
            width: 26px;
            height: 26px;
            border-radius: var(--notion-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--notion-icon);
            transition: all var(--notion-transition-fast) ease;
            background: transparent;
            border: none;
            font-size: 13px;
            font-weight: 400;
            font-family: inherit;
        }

        .notion-toolbar-button:hover {
            background-color: var(--notion-gray2);
            color: var(--notion-icon-hover);
        }

        .notion-toolbar-button.active {
            background-color: var(--notion-gray3);
            color: var(--notion-gray12);
        }

        .notion-toolbar-button.bold {
            font-weight: 700;
        }

        .notion-toolbar-button.italic {
            font-style: italic;
        }

        .notion-toolbar-button.underline {
            text-decoration: underline;
        }

        .notion-toolbar-button.strikethrough {
            text-decoration: line-through;
        }

        .notion-toolbar-button.code {
            font-family: var(--notion-code-font);
            font-size: 12px;
            background-color: var(--notion-gray2);
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* Color Picker */
        .notion-color-picker {
            position: relative;
        }

        .notion-color-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--notion-gray0);
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            padding: 8px;
            box-shadow: 0 4px 12px var(--notion-shadow-hover);
            display: none;
            grid-template-columns: repeat(5, 24px);
            gap: 4px;
            z-index: 1001;
        }

        .notion-color-option {
            width: 24px;
            height: 24px;
            border-radius: var(--notion-radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--notion-transition-fast) ease;
        }

        .notion-color-option:hover {
            border-color: var(--notion-border-hover);
            transform: scale(1.1);
        }

        .notion-color-option.selected {
            border-color: var(--notion-blue);
        }

        /* === BLOCK TYPE SELECTOR === */
        .notion-type-selector {
            position: absolute;
            background-color: var(--notion-gray0);
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            box-shadow: 0 4px 12px var(--notion-shadow-hover);
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            animation: notion-toolbar-fade-in 150ms ease;
        }

        .notion-type-search {
            padding: var(--notion-spacing-xl);
            border-bottom: 1px solid var(--notion-border);
            position: sticky;
            top: 0;
            background-color: var(--notion-gray0);
            z-index: 1;
        }

        .notion-type-search-input {
            width: 100%;
            padding: var(--notion-spacing-md) var(--notion-spacing-lg);
            border-radius: var(--notion-radius);
            border: 1px solid var(--notion-border);
            font-size: 14px;
            background-color: var(--notion-gray1);
            color: var(--notion-gray12);
            font-family: inherit;
            outline: none;
        }

        .notion-type-search-input:focus {
            border-color: var(--notion-blue);
            background-color: var(--notion-gray0);
        }

        .notion-type-category {
            padding: var(--notion-spacing-md) var(--notion-spacing-xl);
        }

        .notion-type-category-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--notion-gray8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--notion-spacing-md);
        }

        .notion-type-option {
            display: flex;
            align-items: center;
            padding: var(--notion-spacing-md);
            border-radius: var(--notion-radius);
            cursor: pointer;
            transition: background-color var(--notion-transition-fast) ease;
            margin-bottom: 2px;
        }

        .notion-type-option:hover {
            background-color: var(--notion-gray1);
        }

        .notion-type-icon {
            width: 20px;
            height: 20px;
            margin-right: var(--notion-spacing-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--notion-icon);
            flex-shrink: 0;
        }

        .notion-type-details {
            flex: 1;
            min-width: 0;
        }

        .notion-type-name {
            font-size: 14px;
            color: var(--notion-gray12);
            margin-bottom: 2px;
        }

        .notion-type-description {
            font-size: 12px;
            color: var(--notion-gray8);
        }

        /* === INLINE FORMATTING === */
        .notion-format-bold {
            font-weight: 700;
        }

        .notion-format-italic {
            font-style: italic;
        }

        .notion-format-underline {
            text-decoration: underline;
        }

        .notion-format-strikethrough {
            text-decoration: line-through;
        }

        .notion-format-code {
            font-family: var(--notion-code-font);
            font-size: 14px;
            background-color: var(--notion-gray2);
            padding: 0.2em 0.4em;
            border-radius: var(--notion-radius-sm);
            color: var(--notion-red-text);
        }

        .notion-format-link {
            color: var(--notion-blue);
            text-decoration: none;
            cursor: pointer;
            border-bottom: 1px solid var(--notion-border);
        }

        .notion-format-link:hover {
            border-bottom-color: var(--notion-blue);
        }

        /* Text Colors */
        .notion-color-gray { color: var(--notion-gray9); }
        .notion-color-brown { color: var(--notion-brown-text); }
        .notion-color-orange { color: var(--notion-orange-text); }
        .notion-color-yellow { color: var(--notion-yellow-text); }
        .notion-color-green { color: var(--notion-teal-text); }
        .notion-color-blue { color: var(--notion-blue-text); }
        .notion-color-purple { color: var(--notion-purple-text); }
        .notion-color-pink { color: var(--notion-pink-text); }
        .notion-color-red { color: var(--notion-red-text); }

        /* Background Colors */
        .notion-bg-gray { background-color: var(--notion-gray-background); }
        .notion-bg-brown { background-color: var(--notion-brown-background); }
        .notion-bg-orange { background-color: var(--notion-orange-background); }
        .notion-bg-yellow { background-color: var(--notion-yellow-background); }
        .notion-bg-green { background-color: var(--notion-teal-background); }
        .notion-bg-blue { background-color: var(--notion-blue-background); }
        .notion-bg-purple { background-color: var(--notion-purple-background); }
        .notion-bg-pink { background-color: var(--notion-pink-background); }
        .notion-bg-red { background-color: var(--notion-red-background); }

        /* === DATABASE/TABLE === */
        .notion-block-database {
            width: 100%;
            overflow-x: auto;
            margin: var(--notion-spacing-xl) 0;
        }

        .notion-database-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            overflow: hidden;
        }

        .notion-database-header {
            background-color: var(--notion-gray1);
            border-bottom: 1px solid var(--notion-border);
        }

        .notion-database-cell {
            padding: var(--notion-spacing-md);
            text-align: left;
            font-weight: 500;
            font-size: 14px;
            color: var(--notion-gray10);
            min-width: 120px;
            border-right: 1px solid var(--notion-border);
            vertical-align: top;
        }

        .notion-database-cell:last-child {
            border-right: none;
        }

        .notion-database-cell-content {
            outline: none;
            min-height: 24px;
            width: 100%;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 14px;
            color: var(--notion-gray12);
        }

        .notion-database-add-row {
            padding: var(--notion-spacing-md);
            color: var(--notion-gray8);
            cursor: pointer;
            text-align: center;
            border-top: 1px solid var(--notion-border);
            font-size: 14px;
        }

        .notion-database-add-row:hover {
            background-color: var(--notion-gray1);
        }

        /* === EMBED BLOCKS === */
        .notion-block-embed {
            width: 100%;
            border: 1px solid var(--notion-border);
            border-radius: var(--notion-radius);
            overflow: hidden;
            margin: var(--notion-spacing-xl) 0;
        }

        .notion-embed-header {
            display: flex;
            align-items: center;
            padding: var(--notion-spacing-md);
            background-color: var(--notion-gray1);
            border-bottom: 1px solid var(--notion-border);
        }

        .notion-embed-icon {
            margin-right: var(--notion-spacing-md);
            color: var(--notion-icon);
        }

        .notion-embed-url {
            flex: 1;
            font-size: 14px;
            color: var(--notion-gray10);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .notion-embed-content {
            padding: var(--notion-spacing-xl);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--notion-gray0);
            color: var(--notion-gray8);
            font-size: 14px;
        }

        /* === IMAGE BLOCK === */
        .notion-block-image {
            width: 100%;
            margin: var(--notion-spacing-xl) 0;
            border-radius: var(--notion-radius);
            overflow: hidden;
            position: relative;
        }

        .notion-image-container {
            width: 100%;
            max-height: 400px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--notion-gray1);
        }

        .notion-image-container img {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            display: block;
        }

        .notion-image-caption {
            padding: var(--notion-spacing-md);
            text-align: center;
            font-size: 14px;
            color: var(--notion-gray9);
            background-color: var(--notion-gray1);
            border-top: 1px solid var(--notion-border);
            outline: none;
            width: 100%;
            border: none;
            font-family: inherit;
        }

        .notion-image-caption:empty:before {
            content: "Write a caption...";
            color: var(--notion-gray7);
            opacity: 0.5;
        }

        /* === SCROLLBAR === */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background-color: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--notion-gray4);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--notion-gray5);
        }

        /* === SELECTION === */
        ::selection {
            background-color: var(--notion-selection);
        }

        /* === RESPONSIVE === */
        @media (max-width: 1200px) {
            .notion-sidebar {
                transform: translateX(-100%);
            }
            
            .notion-sidebar.active {
                transform: translateX(0);
            }
            
            .notion-main {
                margin-left: 0;
            }
            
            .notion-content {
                padding: var(--notion-spacing-3xl) var(--notion-spacing-xl);
            }
        }

        @media (max-width: 768px) {
            .notion-page-title {
                font-size: 32px;
            }
            
            .notion-block-h1 .notion-block-content {
                font-size: 24px;
            }
            
            .notion-block-h2 .notion-block-content {
                font-size: 20px;
            }
            
            .notion-block-h3 .notion-block-content {
                font-size: 18px;
            }
            
            .notion-content {
                padding: var(--notion-spacing-xl) var(--notion-spacing-lg);
            }
            
            .notion-toolbar {
                max-width: 90vw;
                overflow-x: auto;
            }
            
            .notion-type-selector {
                width: 90vw;
                left: 5vw !important;
            }
        }

        /* === DARK MODE === */
        @media (prefers-color-scheme: dark) {
            :root {
                --notion-gray0: #191919;
                --notion-gray1: #202020;
                --notion-gray2: #2a2a2a;
                --notion-gray3: #333333;
                --notion-gray4: #3d3d3d;
                --notion-gray5: #474747;
                --notion-gray6: #515151;
                --notion-gray7: #6b6b6b;
                --notion-gray8: #7a7a7a;
                --notion-gray9: #8a8a8a;
                --notion-gray10: #9a9a9a;
                --notion-gray11: #aaaaaa;
                --notion-gray12: #bababa;
                --notion-gray13: #cacaca;
                --notion-gray14: #dadada;
                
                --notion-border: #333333;
                --notion-border-hover: #3d3d3d;
                --notion-shadow: rgba(0, 0, 0, 0.2);
                --notion-shadow-hover: rgba(0, 0, 0, 0.3);
                --notion-selection: rgba(0, 122, 255, 0.2);
                
                --notion-icon: #8a8a8a;
                --notion-icon-hover: #bababa;
            }
        }

        /* === UTILITY CLASSES === */
        .notion-hidden {
            display: none !important;
        }

        .notion-dragover {
            background-color: var(--notion-gray1);
            border-radius: var(--notion-radius);
        }

        .notion-drop-indicator {
            height: 2px;
            background-color: var(--notion-blue);
            margin: 2px 0;
            border-radius: 1px;
        }
    </style>
</head>
<body>
    <div class="notion-app">
        <!-- Sidebar -->
        <div class="notion-sidebar" id="notionSidebar">
            <div class="notion-sidebar-header">
                <div class="notion-sidebar-title">Workspace</div>
            </div>
            
            <a href="#" class="notion-sidebar-item active">
                <div class="notion-sidebar-icon">üìÑ</div>
                <span>Getting Started</span>
            </a>
            
            <a href="#" class="notion-sidebar-item">
                <div class="notion-sidebar-icon">üìã</div>
                <span>Task Board</span>
            </a>
            
            <a href="#" class="notion-sidebar-item">
                <div class="notion-sidebar-icon">üìä</div>
                <span>Project Docs</span>
            </a>
            
            <div class="notion-sidebar-divider"></div>
            
            <div class="notion-sidebar-title">Quick Notes</div>
            
            <a href="#" class="notion-sidebar-item">
                <div class="notion-sidebar-icon">üí°</div>
                <span>Ideas</span>
            </a>
            
            <a href="#" class="notion-sidebar-item">
                <div class="notion-sidebar-icon">üìù</div>
                <span>Meeting Notes</span>
            </a>
            
            <a href="#" class="notion-sidebar-item">
                <div class="notion-sidebar-icon">üõí</div>
                <span>Shopping List</span>
            </a>
        </div>

        <!-- Main Content -->
        <div class="notion-main">
            <div class="notion-content">
                <!-- Page Header -->
                <div class="notion-page-header">
                    <div class="notion-page-icon" id="pageIcon">üìÑ</div>
                    <textarea 
                        class="notion-page-title" 
                        id="pageTitle" 
                        placeholder="Untitled" 
                        rows="1"
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="true"
                    >Getting Started with Notion Editor</textarea>
                </div>

                <!-- Editor -->
                <div class="notion-editor" id="notionEditor">
                    <!-- Blocks will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Formatting Toolbar -->
        <div class="notion-toolbar" id="notionToolbar">
            <div class="notion-toolbar-group">
                <button class="notion-toolbar-button bold" data-command="bold" title="Bold (Ctrl+B)">B</button>
                <button class="notion-toolbar-button italic" data-command="italic" title="Italic (Ctrl+I)">I</button>
                <button class="notion-toolbar-button underline" data-command="underline" title="Underline (Ctrl+U)">U</button>
                <button class="notion-toolbar-button strikethrough" data-command="strikethrough" title="Strikethrough">S</button>
            </div>
            
            <div class="notion-toolbar-group">
                <button class="notion-toolbar-button code" data-command="code" title="Inline code (Ctrl+E)">{ }</button>
                <button class="notion-toolbar-button" data-command="link" title="Link (Ctrl+K)">üîó</button>
            </div>
            
            <div class="notion-toolbar-group">
                <div class="notion-color-picker">
                    <button class="notion-toolbar-button" id="textColorBtn" title="Text color">A</button>
                    <div class="notion-color-dropdown" id="textColorDropdown">
                        <div class="notion-color-option selected" data-color="default" style="background-color: var(--notion-gray12)"></div>
                        <div class="notion-color-option" data-color="gray" style="background-color: var(--notion-gray9)"></div>
                        <div class="notion-color-option" data-color="brown" style="background-color: var(--notion-brown-text)"></div>
                        <div class="notion-color-option" data-color="orange" style="background-color: var(--notion-orange-text)"></div>
                        <div class="notion-color-option" data-color="yellow" style="background-color: var(--notion-yellow-text)"></div>
                        <div class="notion-color-option" data-color="green" style="background-color: var(--notion-teal-text)"></div>
                        <div class="notion-color-option" data-color="blue" style="background-color: var(--notion-blue-text)"></div>
                        <div class="notion-color-option" data-color="purple" style="background-color: var(--notion-purple-text)"></div>
                        <div class="notion-color-option" data-color="pink" style="background-color: var(--notion-pink-text)"></div>
                        <div class="notion-color-option" data-color="red" style="background-color: var(--notion-red-text)"></div>
                    </div>
                </div>
                
                <div class="notion-color-picker">
                    <button class="notion-toolbar-button" id="bgColorBtn" title="Background color">üñçÔ∏è</button>
                    <div class="notion-color-dropdown" id="bgColorDropdown">
                        <div class="notion-color-option selected" data-bgcolor="default" style="background-color: transparent; border: 1px solid var(--notion-border)"></div>
                        <div class="notion-color-option" data-bgcolor="gray" style="background-color: var(--notion-gray-background)"></div>
                        <div class="notion-color-option" data-bgcolor="brown" style="background-color: var(--notion-brown-background)"></div>
                        <div class="notion-color-option" data-bgcolor="orange" style="background-color: var(--notion-orange-background)"></div>
                        <div class="notion-color-option" data-bgcolor="yellow" style="background-color: var(--notion-yellow-background)"></div>
                        <div class="notion-color-option" data-bgcolor="green" style="background-color: var(--notion-teal-background)"></div>
                        <div class="notion-color-option" data-bgcolor="blue" style="background-color: var(--notion-blue-background)"></div>
                        <div class="notion-color-option" data-bgcolor="purple" style="background-color: var(--notion-purple-background)"></div>
                        <div class="notion-color-option" data-bgcolor="pink" style="background-color: var(--notion-pink-background)"></div>
                        <div class="notion-color-option" data-bgcolor="red" style="background-color: var(--notion-red-background)"></div>
                    </div>
                </div>
            </div>
            
            <div class="notion-toolbar-group">
                <button class="notion-toolbar-button" data-command="h1" title="Heading 1">H1</button>
                <button class="notion-toolbar-button" data-command="h2" title="Heading 2">H2</button>
                <button class="notion-toolbar-button" data-command="h3" title="Heading 3">H3</button>
            </div>
        </div>

        <!-- Block Type Selector -->
        <div class="notion-type-selector" id="notionTypeSelector">
            <div class="notion-type-search">
                <input type="text" class="notion-type-search-input" placeholder="Search for a block type..." id="typeSearchInput">
            </div>
            
            <div class="notion-type-category">
                <div class="notion-type-category-title">Basic Blocks</div>
                <div class="notion-type-option" data-type="text">
                    <div class="notion-type-icon">üìù</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Text</div>
                        <div class="notion-type-description">Just start writing with plain text</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="h1">
                    <div class="notion-type-icon">#</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Heading 1</div>
                        <div class="notion-type-description">Big section heading</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="h2">
                    <div class="notion-type-icon">##</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Heading 2</div>
                        <div class="notion-type-description">Medium section heading</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="h3">
                    <div class="notion-type-icon">###</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Heading 3</div>
                        <div class="notion-type-description">Small section heading</div>
                    </div>
                </div>
            </div>
            
            <div class="notion-type-category">
                <div class="notion-type-category-title">Lists</div>
                <div class="notion-type-option" data-type="bulleted">
                    <div class="notion-type-icon">‚Ä¢</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Bulleted List</div>
                        <div class="notion-type-description">Create a simple bulleted list</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="numbered">
                    <div class="notion-type-icon">1.</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Numbered List</div>
                        <div class="notion-type-description">Create a numbered list</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="todo">
                    <div class="notion-type-icon">‚òê</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">To-do List</div>
                        <div class="notion-type-description">Track tasks with a checkbox</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="toggle">
                    <div class="notion-type-icon">‚ñº</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Toggle List</div>
                        <div class="notion-type-description">Create a toggleable list</div>
                    </div>
                </div>
            </div>
            
            <div class="notion-type-category">
                <div class="notion-type-category-title">Media</div>
                <div class="notion-type-option" data-type="image">
                    <div class="notion-type-icon">üñºÔ∏è</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Image</div>
                        <div class="notion-type-description">Upload or embed an image</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="embed">
                    <div class="notion-type-icon">üîó</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Embed</div>
                        <div class="notion-type-description">Embed a website or content</div>
                    </div>
                </div>
            </div>
            
            <div class="notion-type-category">
                <div class="notion-type-category-title">Advanced</div>
                <div class="notion-type-option" data-type="code">
                    <div class="notion-type-icon">{ }</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Code</div>
                        <div class="notion-type-description">Capture a code snippet</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="quote">
                    <div class="notion-type-icon">‚ùù</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Quote</div>
                        <div class="notion-type-description">Capture a quote</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="callout">
                    <div class="notion-type-icon">üí°</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Callout</div>
                        <div class="notion-type-description">Make writing stand out</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="divider">
                    <div class="notion-type-icon">‚Äî</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Divider</div>
                        <div class="notion-type-description">Visual divider</div>
                    </div>
                </div>
                
                <div class="notion-type-option" data-type="database">
                    <div class="notion-type-icon">üóÉÔ∏è</div>
                    <div class="notion-type-details">
                        <div class="notion-type-name">Database</div>
                        <div class="notion-type-description">Create a table or board</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // NOTION EDITOR CORE
        // ============================
        
        class NotionEditorCore {
            constructor() {
                this.blocks = [];
                this.currentBlock = null;
                this.selectedBlocks = new Set();
                this.draggingBlock = null;
                this.dragOverBlock = null;
                this.dragOffset = 0;
                this.history = [];
                this.historyIndex = -1;
                this.init();
            }

            init() {
                this.loadInitialContent();
                this.setupEventListeners();
                this.setupKeyboardShortcuts();
                this.setupDragAndDrop();
                this.setupFormatting();
                this.setupBlockSelector();
                this.setupAutoSave();
            }

            loadInitialContent() {
                const initialBlocks = [
                    { type: 'text', content: 'Welcome to your Notion editor replica!', id: 'block-1' },
                    { type: 'text', content: 'This is a fully functional clone with all core features.', id: 'block-2' },
                    { type: 'h1', content: 'Features', id: 'block-3' },
                    { type: 'bulleted', content: 'Rich text formatting', id: 'block-4' },
                    { type: 'bulleted', content: 'Multiple block types', id: 'block-5' },
                    { type: 'bulleted', content: 'Drag and drop reordering', id: 'block-6' },
                    { type: 'bulleted', content: 'Keyboard shortcuts', id: 'block-7' },
                    { type: 'h2', content: 'Try It Out', id: 'block-8' },
                    { type: 'todo', content: 'Click a checkbox to toggle', checked: false, id: 'block-9' },
                    { type: 'todo', content: 'Try the / command', checked: true, id: 'block-10' },
                    { type: 'code', content: 'function hello() {\n  console.log("Hello, Notion!");\n}', language: 'javascript', id: 'block-11' },
                    { type: 'quote', content: 'This is a quote block', id: 'block-12' },
                    { type: 'callout', content: 'This is a callout block for important notes', id: 'block-13' },
                    { type: 'divider', content: '', id: 'block-14' },
                    { type: 'text', content: 'Select text to see formatting options', id: 'block-15' }
                ];

                initialBlocks.forEach((block, index) => {
                    this.addBlock(block.type, block.content, index, block);
                });
            }

            addBlock(type, content = '', position = this.blocks.length, options = {}) {
                const block = {
                    id: options.id || 'block-' + Date.now() + Math.random().toString(36).substr(2, 9),
                    type: type,
                    content: content,
                    color: options.color || 'default',
                    bgColor: options.bgColor || 'default',
                    checked: options.checked || false,
                    language: options.language || 'javascript',
                    collapsed: options.collapsed || false,
                    properties: options.properties || {}
                };

                if (position === this.blocks.length) {
                    this.blocks.push(block);
                } else {
                    this.blocks.splice(position, 0, block);
                }

                this.renderBlock(block, position);
                this.saveHistory();
                return block;
            }

            renderBlock(block, position) {
                const editor = document.getElementById('notionEditor');
                const blockElement = this.createBlockElement(block);
                
                if (position >= this.blocks.length - 1) {
                    editor.appendChild(blockElement);
                } else {
                    const existingBlocks = editor.querySelectorAll('.notion-block');
                    if (existingBlocks[position]) {
                        editor.insertBefore(blockElement, existingBlocks[position]);
                    } else {
                        editor.appendChild(blockElement);
                    }
                }

                this.updateNumberedLists();
                
                // Focus if it's a new block
                if (!block.content && block.type !== 'divider') {
                    setTimeout(() => {
                        const contentElement = blockElement.querySelector('.notion-block-content');
                        if (contentElement) {
                            contentElement.focus();
                        }
                    }, 10);
                }
            }

            createBlockElement(block) {
                const div = document.createElement('div');
                div.className = `notion-block notion-block-${block.type}`;
                div.dataset.id = block.id;
                div.dataset.type = block.type;

                // Block handle
                const handle = document.createElement('button');
                handle.className = 'notion-block-handle';
                handle.innerHTML = '‚ãÆ‚ãÆ';
                handle.setAttribute('aria-label', 'Drag block');
                div.appendChild(handle);

                // Block content based on type
                switch(block.type) {
                    case 'h1':
                    case 'h2':
                    case 'h3':
                    case 'text':
                    case 'bulleted':
                    case 'numbered':
                    case 'quote':
                        div.appendChild(this.createTextContent(block));
                        break;
                        
                    case 'todo':
                        div.appendChild(this.createTodoContent(block));
                        break;
                        
                    case 'toggle':
                        div.appendChild(this.createToggleContent(block));
                        break;
                        
                    case 'code':
                        div.appendChild(this.createCodeContent(block));
                        break;
                        
                    case 'callout':
                        div.appendChild(this.createCalloutContent(block));
                        break;
                        
                    case 'divider':
                        div.innerHTML = '<div class="notion-block-divider"></div>';
                        break;
                        
                    case 'database':
                        div.appendChild(this.createDatabaseContent(block));
                        break;
                        
                    case 'image':
                        div.appendChild(this.createImageContent(block));
                        break;
                        
                    case 'embed':
                        div.appendChild(this.createEmbedContent(block));
                        break;
                }

                // Block actions
                const actions = document.createElement('div');
                actions.className = 'notion-block-actions';
                actions.innerHTML = `
                    <button class="notion-block-action" title="Delete" data-action="delete">üóëÔ∏è</button>
                    <button class="notion-block-action" title="Duplicate" data-action="duplicate">üìã</button>
                    <button class="notion-block-action" title="Turn into" data-action="convert">‚§µÔ∏è</button>
                `;
                div.appendChild(actions);

                this.attachBlockEvents(div, block);
                return div;
            }

            createTextContent(block) {
                const content = document.createElement('div');
                content.className = `notion-block-content ${block.color !== 'default' ? `notion-color-${block.color}` : ''} ${block.bgColor !== 'default' ? `notion-bg-${block.bgColor}` : ''}`;
                content.contentEditable = true;
                content.dataset.placeholder = "Type '/' for commands";
                content.dataset.id = block.id;
                
                // Set initial content with formatting preserved
                this.setContentWithFormatting(content, block.content);
                
                return content;
            }

            createTodoContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-todo' + (block.checked ? ' checked' : '');
                
                const checkbox = document.createElement('div');
                checkbox.className = 'notion-todo-checkbox' + (block.checked ? ' checked' : '');
                checkbox.dataset.id = block.id;
                
                const content = document.createElement('div');
                content.className = `notion-block-content ${block.color !== 'default' ? `notion-color-${block.color}` : ''} ${block.bgColor !== 'default' ? `notion-bg-${block.bgColor}` : ''}`;
                content.contentEditable = true;
                content.dataset.placeholder = "To-do";
                content.dataset.id = block.id;
                this.setContentWithFormatting(content, block.content);
                
                container.appendChild(checkbox);
                container.appendChild(content);
                return container;
            }

            createToggleContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-toggle';
                
                const header = document.createElement('div');
                header.className = 'notion-toggle-header';
                header.dataset.id = block.id;
                
                const icon = document.createElement('div');
                icon.className = 'notion-toggle-icon' + (block.collapsed ? ' collapsed' : '');
                icon.innerHTML = '‚ñº';
                
                const content = document.createElement('div');
                content.className = `notion-block-content ${block.color !== 'default' ? `notion-color-${block.color}` : ''} ${block.bgColor !== 'default' ? `notion-bg-${block.bgColor}` : ''}`;
                content.contentEditable = true;
                content.dataset.placeholder = "Toggle heading";
                content.dataset.id = block.id;
                this.setContentWithFormatting(content, block.content);
                
                const toggleContent = document.createElement('div');
                toggleContent.className = 'notion-toggle-content' + (block.collapsed ? ' collapsed' : '');
                toggleContent.dataset.id = block.id;
                
                // Add empty block inside toggle
                const innerBlock = document.createElement('div');
                innerBlock.className = 'notion-block notion-block-text';
                const innerContent = document.createElement('div');
                innerContent.className = 'notion-block-content';
                innerContent.contentEditable = true;
                innerContent.dataset.placeholder = "Toggle content";
                innerBlock.appendChild(innerContent);
                toggleContent.appendChild(innerBlock);
                
                header.appendChild(icon);
                header.appendChild(content);
                container.appendChild(header);
                container.appendChild(toggleContent);
                return container;
            }

            createCodeContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-code';
                
                const language = document.createElement('div');
                language.className = 'notion-code-language';
                language.textContent = block.language;
                
                const content = document.createElement('pre');
                content.className = 'notion-block-content';
                content.contentEditable = true;
                content.dataset.placeholder = "Write code here...";
                content.dataset.id = block.id;
                content.spellcheck = false;
                content.textContent = block.content;
                
                container.appendChild(language);
                container.appendChild(content);
                return container;
            }

            createCalloutContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-callout';
                
                const icon = document.createElement('div');
                icon.className = 'notion-callout-icon';
                icon.innerHTML = 'üí°';
                
                const content = document.createElement('div');
                content.className = `notion-block-content ${block.color !== 'default' ? `notion-color-${block.color}` : ''} ${block.bgColor !== 'default' ? `notion-bg-${block.bgColor}` : ''}`;
                content.contentEditable = true;
                content.dataset.placeholder = "Callout text";
                content.dataset.id = block.id;
                this.setContentWithFormatting(content, block.content);
                
                container.appendChild(icon);
                container.appendChild(content);
                return container;
            }

            createDatabaseContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-database';
                
                const table = document.createElement('table');
                table.className = 'notion-database-table';
                
                // Header
                const thead = document.createElement('thead');
                thead.className = 'notion-database-header';
                const headerRow = document.createElement('tr');
                
                ['Name', 'Status', 'Date', 'Tags'].forEach(header => {
                    const th = document.createElement('th');
                    th.className = 'notion-database-cell';
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // Body
                const tbody = document.createElement('tbody');
                const sampleData = [
                    { name: 'Task 1', status: 'Todo', date: '2024-01-01', tags: 'Design' },
                    { name: 'Task 2', status: 'In Progress', date: '2024-01-02', tags: 'Development' }
                ];
                
                sampleData.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.className = 'notion-database-row';
                    
                    Object.values(row).forEach(cell => {
                        const td = document.createElement('td');
                        td.className = 'notion-database-cell';
                        const content = document.createElement('div');
                        content.className = 'notion-database-cell-content';
                        content.contentEditable = true;
                        content.textContent = cell;
                        td.appendChild(content);
                        tr.appendChild(td);
                    });
                    
                    tbody.appendChild(tr);
                });
                
                table.appendChild(tbody);
                container.appendChild(table);
                
                // Add row button
                const addRow = document.createElement('div');
                addRow.className = 'notion-database-add-row';
                addRow.textContent = '+ Add a row';
                addRow.addEventListener('click', () => this.addDatabaseRow(table));
                container.appendChild(addRow);
                
                return container;
            }

            createImageContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-image';
                
                const imgContainer = document.createElement('div');
                imgContainer.className = 'notion-image-container';
                
                const img = document.createElement('img');
                img.src = block.content || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjFGMEVGIi8+CjxwYXRoIGQ9Ik0xMjAgMTIwTDE2MCAxODBMMjAwIDE0MEwyNDAgMTgwTDI4MCAxMjAiIHN0cm9rZT0iI0Q4RDdENCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjEyMCIgcj0iMjAiIHN0cm9rZT0iI0Q4RDdENCIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==';
                img.alt = 'Image placeholder';
                
                const caption = document.createElement('div');
                caption.className = 'notion-image-caption';
                caption.contentEditable = true;
                caption.dataset.placeholder = "Write a caption...";
                
                imgContainer.appendChild(img);
                container.appendChild(imgContainer);
                container.appendChild(caption);
                
                return container;
            }

            createEmbedContent(block) {
                const container = document.createElement('div');
                container.className = 'notion-block-embed';
                
                const header = document.createElement('div');
                header.className = 'notion-embed-header';
                
                const icon = document.createElement('div');
                icon.className = 'notion-embed-icon';
                icon.innerHTML = 'üîó';
                
                const url = document.createElement('div');
                url.className = 'notion-embed-url';
                url.textContent = block.content || 'https://example.com';
                
                const content = document.createElement('div');
                content.className = 'notion-embed-content';
                content.textContent = 'Embed content preview';
                
                header.appendChild(icon);
                header.appendChild(url);
                container.appendChild(header);
                container.appendChild(content);
                
                return container;
            }

            setContentWithFormatting(element, content) {
                // Simple formatting parser
                if (!content) {
                    element.textContent = '';
                    return;
                }
                
                // Clear element
                element.innerHTML = '';
                
                // Parse simple markdown-like syntax
                const lines = content.split('\n');
                lines.forEach((line, index) => {
                    if (index > 0) {
                        element.appendChild(document.createElement('br'));
                    }
                    
                    const textNode = document.createTextNode(line);
                    element.appendChild(textNode);
                });
            }

            attachBlockEvents(element, block) {
                // Content editing
                const contentEl = element.querySelector('.notion-block-content');
                if (contentEl) {
                    contentEl.addEventListener('input', (e) => this.handleBlockInput(e, block.id));
                    contentEl.addEventListener('focus', (e) => this.handleBlockFocus(e, block.id));
                    contentEl.addEventListener('blur', (e) => this.handleBlockBlur(e, block.id));
                    contentEl.addEventListener('keydown', (e) => this.handleBlockKeyDown(e, block.id));
                    contentEl.addEventListener('mouseup', (e) => this.handleSelectionChange(e));
                    contentEl.addEventListener('paste', (e) => this.handlePaste(e));
                }

                // Todo checkbox
                const checkbox = element.querySelector('.notion-todo-checkbox');
                if (checkbox) {
                    checkbox.addEventListener('click', (e) => this.handleTodoToggle(e, block.id));
                }

                // Toggle header
                const toggleHeader = element.querySelector('.notion-toggle-header');
                if (toggleHeader) {
                    toggleHeader.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('notion-block-content')) {
                            this.handleToggleClick(e, block.id);
                        }
                    });
                }

                // Block actions
                const actions = element.querySelector('.notion-block-actions');
                if (actions) {
                    actions.addEventListener('click', (e) => {
                        const action = e.target.closest('.notion-block-action');
                        if (action) {
                            e.stopPropagation();
                            this.handleBlockAction(action.dataset.action, block.id);
                        }
                    });
                }

                // Context menu
                element.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e, block.id);
                });
            }

            // ============================
            // EVENT HANDLERS
            // ============================

            handleBlockInput(e, blockId) {
                const block = this.blocks.find(b => b.id === blockId);
                if (block) {
                    block.content = e.target.textContent;
                    this.saveHistory();
                }
            }

            handleBlockFocus(e, blockId) {
                const block = this.blocks.find(b => b.id === blockId);
                if (block) {
                    this.currentBlock = block;
                    
                    // Add selected class
                    const container = e.target.closest('.notion-block');
                    if (container) {
                        document.querySelectorAll('.notion-block.selected').forEach(b => {
                            b.classList.remove('selected');
                        });
                        container.classList.add('selected');
                        this.selectedBlocks.clear();
                        this.selectedBlocks.add(blockId);
                    }
                }
            }

            handleBlockBlur(e, blockId) {
                setTimeout(() => {
                    const container = e.target.closest('.notion-block');
                    if (container && !container.contains(document.activeElement)) {
                        container.classList.remove('selected');
                        this.selectedBlocks.delete(blockId);
                    }
                }, 100);
            }

            handleBlockKeyDown(e, blockId) {
                const blockIndex = this.blocks.findIndex(b => b.id === blockId);
                
                switch(e.key) {
                    case 'Enter':
                        if (!e.shiftKey) {
                            e.preventDefault();
                            this.handleEnterKey(e, blockId, blockIndex);
                        }
                        break;
                        
                    case 'Backspace':
                        if (e.target.textContent === '' && this.blocks.length > 1) {
                            e.preventDefault();
                            this.handleBackspaceKey(blockId, blockIndex);
                        }
                        break;
                        
                    case 'Tab':
                        e.preventDefault();
                        this.handleTabKey(e.shiftKey, blockId, blockIndex);
                        break;
                        
                    case '/':
                        if (e.target.textContent === '/' || e.target.textContent === '') {
                            e.preventDefault();
                            this.showBlockTypeSelector(e.target, blockId);
                        }
                        break;
                        
                    case 'ArrowUp':
                        if (this.isCursorAtStart(e.target)) {
                            e.preventDefault();
                            this.focusPreviousBlock(blockIndex);
                        }
                        break;
                        
                    case 'ArrowDown':
                        if (this.isCursorAtEnd(e.target)) {
                            e.preventDefault();
                            this.focusNextBlock(blockIndex);
                        }
                        break;
                }

                // Formatting shortcuts
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'b':
                            e.preventDefault();
                            this.toggleFormat('bold');
                            break;
                        case 'i':
                            e.preventDefault();
                            this.toggleFormat('italic');
                            break;
                        case 'u':
                            e.preventDefault();
                            this.toggleFormat('underline');
                            break;
                        case 'k':
                            e.preventDefault();
                            this.createLink();
                            break;
                        case 'e':
                            e.preventDefault();
                            this.toggleFormat('code');
                            break;
                        case 'z':
                            if (!e.shiftKey) {
                                e.preventDefault();
                                this.undo();
                            }
                            break;
                        case 'y':
                            if (e.shiftKey) {
                                e.preventDefault();
                                this.redo();
                            }
                            break;
                    }
                }
            }

            handleEnterKey(e, blockId, blockIndex) {
                const block = this.blocks[blockIndex];
                const content = e.target.textContent.trim();
                
                // Handle markdown shortcuts
                if (content === '#') {
                    this.convertBlock(blockId, 'h1', '');
                } else if (content === '##') {
                    this.convertBlock(blockId, 'h2', '');
                } else if (content === '###') {
                    this.convertBlock(blockId, 'h3', '');
                } else if (content === '-') {
                    this.convertBlock(blockId, 'bulleted', '');
                } else if (content === '1.') {
                    this.convertBlock(blockId, 'numbered', '');
                } else if (content === '[]') {
                    this.convertBlock(blockId, 'todo', '', { checked: false });
                } else if (content === '>') {
                    this.convertBlock(blockId, 'quote', '');
                } else if (content === '```') {
                    this.convertBlock(blockId, 'code', '');
                } else {
                    // Add new block
                    const newBlock = this.addBlock('text', '', blockIndex + 1);
                    
                    // Focus new block
                    setTimeout(() => {
                        const newBlockEl = document.querySelector(`[data-id="${newBlock.id}"] .notion-block-content`);
                        if (newBlockEl) {
                            newBlockEl.focus();
                        }
                    }, 10);
                }
            }

            handleBackspaceKey(blockId, blockIndex) {
                if (blockIndex > 0) {
                    this.deleteBlock(blockId);
                    const prevBlock = this.blocks[blockIndex - 1];
                    const prevBlockEl = document.querySelector(`[data-id="${prevBlock.id}"] .notion-block-content`);
                    if (prevBlockEl) {
                        setTimeout(() => {
                            prevBlockEl.focus();
                            this.moveCursorToEnd(prevBlockEl);
                        }, 10);
                    }
                }
            }

            handleTabKey(isShiftKey, blockId, blockIndex) {
                // Implementation for indentation
                console.log('Tab pressed, indentation logic here');
            }

            handleTodoToggle(e, blockId) {
                const block = this.blocks.find(b => b.id === blockId);
                if (block) {
                    block.checked = !block.checked;
                    
                    const container = document.querySelector(`[data-id="${blockId}"]`);
                    const checkbox = container.querySelector('.notion-todo-checkbox');
                    const content = container.querySelector('.notion-block-content');
                    
                    checkbox.classList.toggle('checked', block.checked);
                    container.classList.toggle('checked', block.checked);
                    
                    this.saveHistory();
                }
            }

            handleToggleClick(e, blockId) {
                const block = this.blocks.find(b => b.id === blockId);
                if (block) {
                    block.collapsed = !block.collapsed;
                    
                    const container = document.querySelector(`[data-id="${blockId}"]`);
                    const icon = container.querySelector('.notion-toggle-icon');
                    const content = container.querySelector('.notion-toggle-content');
                    
                    icon.classList.toggle('collapsed', block.collapsed);
                    content.classList.toggle('collapsed', block.collapsed);
                    
                    this.saveHistory();
                }
            }

            handleBlockAction(action, blockId) {
                const blockIndex = this.blocks.findIndex(b => b.id === blockId);
                
                switch(action) {
                    case 'delete':
                        this.deleteBlock(blockId);
                        break;
                        
                    case 'duplicate':
                        this.duplicateBlock(blockId, blockIndex);
                        break;
                        
                    case 'convert':
                        this.showConvertMenu(blockId);
                        break;
                }
            }

            handleSelectionChange(e) {
                setTimeout(() => {
                    const selection = window.getSelection();
                    if (selection.toString().trim().length > 0) {
                        this.showFormattingToolbar(e.target);
                    }
                }, 50);
            }

            handlePaste(e) {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                document.execCommand('insertText', false, text);
            }

            // ============================
            // BLOCK MANAGEMENT
            // ============================

            deleteBlock(blockId) {
                const blockIndex = this.blocks.findIndex(b => b.id === blockId);
                if (blockIndex !== -1) {
                    this.blocks.splice(blockIndex, 1);
                    const blockEl = document.querySelector(`[data-id="${blockId}"]`);
                    if (blockEl) {
                        blockEl.remove();
                        this.updateNumberedLists();
                        this.saveHistory();
                    }
                }
            }

            duplicateBlock(blockId, blockIndex) {
                const block = this.blocks[blockIndex];
                if (block) {
                    const newBlock = { ...block, id: 'block-' + Date.now() + Math.random().toString(36).substr(2, 9) };
                    this.blocks.splice(blockIndex + 1, 0, newBlock);
                    this.renderBlock(newBlock, blockIndex + 1);
                    this.saveHistory();
                }
            }

            convertBlock(blockId, newType, content = '', options = {}) {
                const blockIndex = this.blocks.findIndex(b => b.id === blockId);
                if (blockIndex !== -1) {
                    const oldBlock = this.blocks[blockIndex];
                    
                    const newBlock = {
                        ...oldBlock,
                        id: oldBlock.id,
                        type: newType,
                        content: content || oldBlock.content,
                        ...options
                    };
                    
                    this.blocks[blockIndex] = newBlock;
                    
                    // Remove old element
                    const oldElement = document.querySelector(`[data-id="${blockId}"]`);
                    if (oldElement) {
                        oldElement.remove();
                    }
                    
                    // Render new element
                    this.renderBlock(newBlock, blockIndex);
                    this.saveHistory();
                }
            }

            updateNumberedLists() {
                let counter = 1;
                document.querySelectorAll('.notion-block-numbered').forEach(block => {
                    block.style.counterIncrement = 'notion-list';
                    block.style.counterReset = 'notion-list ' + counter;
                    counter++;
                });
            }

            // ============================
            // FORMATTING
            // ============================

            showFormattingToolbar(targetElement) {
                const toolbar = document.getElementById('notionToolbar');
                const selection = window.getSelection();
                
                if (!selection.toString()) {
                    toolbar.style.display = 'none';
                    return;
                }

                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                
                toolbar.style.left = (rect.left + window.scrollX - 50) + 'px';
                toolbar.style.top = (rect.top + window.scrollY - 45) + 'px';
                toolbar.style.display = 'flex';

                this.updateFormattingButtons();
            }

            updateFormattingButtons() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                const container = range.commonAncestorContainer;
                const element = container.nodeType === 3 ? container.parentElement : container;

                // Check for active formats
                document.querySelectorAll('.notion-toolbar-button[data-command]').forEach(btn => {
                    const format = btn.dataset.command;
                    let isActive = false;
                    
                    switch(format) {
                        case 'bold':
                            isActive = element.closest('.notion-format-bold') !== null || 
                                      window.getComputedStyle(element).fontWeight === '700';
                            break;
                        case 'italic':
                            isActive = element.closest('.notion-format-italic') !== null ||
                                      window.getComputedStyle(element).fontStyle === 'italic';
                            break;
                        case 'underline':
                            isActive = element.closest('.notion-format-underline') !== null ||
                                      window.getComputedStyle(element).textDecoration.includes('underline');
                            break;
                        case 'strikethrough':
                            isActive = element.closest('.notion-format-strikethrough') !== null ||
                                      window.getComputedStyle(element).textDecoration.includes('line-through');
                            break;
                        case 'code':
                            isActive = element.closest('.notion-format-code') !== null;
                            break;
                    }
                    
                    btn.classList.toggle('active', isActive);
                });
            }

            toggleFormat(format) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                
                switch(format) {
                    case 'bold':
                    case 'italic':
                    case 'underline':
                    case 'strikethrough':
                        document.execCommand(format);
                        break;
                        
                    case 'code':
                        const codeElement = document.createElement('code');
                        codeElement.className = 'notion-format-code';
                        
                        if (range.collapsed) {
                            codeElement.innerHTML = '&nbsp;';
                            range.insertNode(codeElement);
                            range.setStartAfter(codeElement);
                            range.setEndAfter(codeElement);
                        } else {
                            try {
                                range.surroundContents(codeElement);
                            } catch (e) {
                                // If surroundContents fails, use execCommand
                                document.execCommand('formatBlock', false, 'code');
                            }
                        }
                        break;
                }
                
                selection.removeAllRanges();
                selection.addRange(range);
                this.updateFormattingButtons();
            }

            createLink() {
                const url = prompt('Enter URL:');
                if (url) {
                    document.execCommand('createLink', false, url);
                    
                    // Add Notion link styling
                    const selection = window.getSelection();
                    if (selection.rangeCount) {
                        const range = selection.getRangeAt(0);
                        const link = range.startContainer.parentElement;
                        if (link.tagName === 'A') {
                            link.className = 'notion-format-link';
                        }
                    }
                }
            }

            // ============================
            // BLOCK TYPE SELECTOR
            // ============================

            showBlockTypeSelector(targetElement, blockId) {
                const selector = document.getElementById('notionTypeSelector');
                const rect = targetElement.getBoundingClientRect();
                
                selector.style.left = (rect.left + window.scrollX) + 'px';
                selector.style.top = (rect.top + window.scrollY + rect.height + 5) + 'px';
                selector.style.display = 'block';
                selector.dataset.currentBlock = blockId;
                
                // Focus search
                const searchInput = selector.querySelector('.notion-type-search-input');
                setTimeout(() => {
                    searchInput.focus();
                    searchInput.select();
                }, 10);
            }

            // ============================
            // NAVIGATION
            // ============================

            focusPreviousBlock(currentIndex) {
                if (currentIndex > 0) {
                    const prevBlock = this.blocks[currentIndex - 1];
                    const prevBlockEl = document.querySelector(`[data-id="${prevBlock.id}"] .notion-block-content`);
                    if (prevBlockEl) {
                        prevBlockEl.focus();
                        this.moveCursorToEnd(prevBlockEl);
                    }
                }
            }

            focusNextBlock(currentIndex) {
                if (currentIndex < this.blocks.length - 1) {
                    const nextBlock = this.blocks[currentIndex + 1];
                    const nextBlockEl = document.querySelector(`[data-id="${nextBlock.id}"] .notion-block-content`);
                    if (nextBlockEl) {
                        nextBlockEl.focus();
                        this.moveCursorToStart(nextBlockEl);
                    }
                }
            }

            moveCursorToEnd(element) {
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(element);
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
            }

            moveCursorToStart(element) {
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(element);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            }

            isCursorAtStart(element) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return false;
                
                const range = selection.getRangeAt(0);
                return range.startOffset === 0 && range.startContainer === element;
            }

            isCursorAtEnd(element) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return false;
                
                const range = selection.getRangeAt(0);
                return range.endOffset === element.textContent.length && range.endContainer === element;
            }

            // ============================
            // DRAG AND DROP
            // ============================

            setupDragAndDrop() {
                let draggedBlock = null;
                let dropIndicator = null;

                document.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('notion-block-handle')) {
                        draggedBlock = e.target.closest('.notion-block');
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', '');
                        
                        draggedBlock.classList.add('dragging');
                    }
                });

                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    
                    const blockContainer = e.target.closest('.notion-block');
                    if (blockContainer && blockContainer !== draggedBlock) {
                        if (!dropIndicator) {
                            dropIndicator = document.createElement('div');
                            dropIndicator.className = 'notion-drop-indicator';
                            document.body.appendChild(dropIndicator);
                        }
                        
                        const rect = blockContainer.getBoundingClientRect();
                        const midpoint = rect.top + rect.height / 2;
                        
                        if (e.clientY < midpoint) {
                            dropIndicator.style.left = rect.left + 'px';
                            dropIndicator.style.top = (rect.top - 1) + 'px';
                            dropIndicator.style.width = rect.width + 'px';
                        } else {
                            dropIndicator.style.left = rect.left + 'px';
                            dropIndicator.style.top = (rect.bottom - 1) + 'px';
                            dropIndicator.style.width = rect.width + 'px';
                        }
                    }
                });

                document.addEventListener('dragleave', (e) => {
                    if (dropIndicator && !e.relatedTarget?.closest('.notion-block')) {
                        dropIndicator.remove();
                        dropIndicator = null;
                    }
                });

                document.addEventListener('drop', (e) => {
                    e.preventDefault();
                    
                    if (draggedBlock && dropIndicator) {
                        const editor = document.getElementById('notionEditor');
                        const blocks = Array.from(editor.querySelectorAll('.notion-block'));
                        const dropIndex = blocks.findIndex(block => {
                            const rect = block.getBoundingClientRect();
                            return e.clientY < rect.top + rect.height / 2;
                        });
                        
                        const currentIndex = blocks.indexOf(draggedBlock);
                        
                        if (dropIndex !== -1 && dropIndex !== currentIndex) {
                            if (dropIndex > currentIndex) {
                                editor.insertBefore(draggedBlock, blocks[dropIndex]);
                            } else {
                                editor.insertBefore(draggedBlock, blocks[dropIndex]);
                            }
                            
                            // Update blocks array
                            this.updateBlocksOrder();
                        }
                        
                        dropIndicator.remove();
                        dropIndicator = null;
                    }
                });

                document.addEventListener('dragend', () => {
                    if (draggedBlock) {
                        draggedBlock.classList.remove('dragging');
                        draggedBlock = null;
                    }
                    
                    if (dropIndicator) {
                        dropIndicator.remove();
                        dropIndicator = null;
                    }
                });
            }

            updateBlocksOrder() {
                const editor = document.getElementById('notionEditor');
                const blockElements = editor.querySelectorAll('.notion-block');
                const newBlocks = [];
                
                blockElements.forEach(element => {
                    const blockId = element.dataset.id;
                    const block = this.blocks.find(b => b.id === blockId);
                    if (block) {
                        newBlocks.push(block);
                    }
                });
                
                this.blocks = newBlocks;
                this.saveHistory();
            }

            // ============================
            // SETUP METHODS
            // ============================

            setupEventListeners() {
                // Page title auto-resize
                const pageTitle = document.getElementById('pageTitle');
                pageTitle.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });

                // Formatting toolbar buttons
                document.querySelectorAll('.notion-toolbar-button[data-command]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const command = e.target.dataset.command;
                        this.handleToolbarCommand(command);
                    });
                });

                // Color pickers
                const textColorBtn = document.getElementById('textColorBtn');
                const bgColorBtn = document.getElementById('bgColorBtn');
                const textColorDropdown = document.getElementById('textColorDropdown');
                const bgColorDropdown = document.getElementById('bgColorDropdown');

                textColorBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    textColorDropdown.style.display = 
                        textColorDropdown.style.display === 'grid' ? 'none' : 'grid';
                    bgColorDropdown.style.display = 'none';
                });

                bgColorBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bgColorDropdown.style.display = 
                        bgColorDropdown.style.display === 'grid' ? 'none' : 'grid';
                    textColorDropdown.style.display = 'none';
                });

                // Color options
                document.querySelectorAll('.notion-color-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const color = e.target.dataset.color || e.target.dataset.bgcolor;
                        const isBgColor = !!e.target.dataset.bgcolor;
                        
                        if (isBgColor) {
                            this.applyBackgroundColor(color);
                        } else {
                            this.applyTextColor(color);
                        }
                        
                        // Update selection
                        e.target.parentElement.querySelectorAll('.notion-color-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        e.target.classList.add('selected');
                        
                        // Hide dropdown
                        e.target.parentElement.style.display = 'none';
                    });
                });

                // Block type selector
                document.querySelectorAll('.notion-type-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const type = e.currentTarget.dataset.type;
                        const selector = document.getElementById('notionTypeSelector');
                        const blockId = selector.dataset.currentBlock;
                        
                        if (blockId) {
                            this.convertBlock(blockId, type);
                        } else {
                            this.addBlock(type);
                        }
                        
                        selector.style.display = 'none';
                    });
                });

                // Type search
                const typeSearch = document.getElementById('typeSearchInput');
                typeSearch.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    document.querySelectorAll('.notion-type-option').forEach(option => {
                        const name = option.querySelector('.notion-type-name').textContent.toLowerCase();
                        const description = option.querySelector('.notion-type-description').textContent.toLowerCase();
                        const matches = name.includes(searchTerm) || description.includes(searchTerm);
                        option.style.display = matches ? 'flex' : 'none';
                    });
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.notion-color-picker')) {
                        textColorDropdown.style.display = 'none';
                        bgColorDropdown.style.display = 'none';
                    }
                    
                    if (!e.target.closest('.notion-type-selector') && !e.target.matches('.notion-block-content')) {
                        document.getElementById('notionTypeSelector').style.display = 'none';
                    }
                    
                    if (!e.target.closest('.notion-toolbar')) {
                        document.getElementById('notionToolbar').style.display = 'none';
                    }
                });

                // Sidebar items
                document.querySelectorAll('.notion-sidebar-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.querySelectorAll('.notion-sidebar-item').forEach(i => {
                            i.classList.remove('active');
                        });
                        item.classList.add('active');
                    });
                });

                // Page icon click
                document.getElementById('pageIcon').addEventListener('click', () => {
                    this.showEmojiPicker();
                });
            }

            handleToolbarCommand(command) {
                switch(command) {
                    case 'bold':
                    case 'italic':
                    case 'underline':
                    case 'strikethrough':
                    case 'code':
                        this.toggleFormat(command);
                        break;
                    case 'link':
                        this.createLink();
                        break;
                    case 'h1':
                        this.convertCurrentBlock('h1');
                        break;
                    case 'h2':
                        this.convertCurrentBlock('h2');
                        break;
                    case 'h3':
                        this.convertCurrentBlock('h3');
                        break;
                }
            }

            applyTextColor(color) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.className = `notion-color-${color}`;
                
                if (range.collapsed) {
                    span.innerHTML = '&nbsp;';
                    range.insertNode(span);
                    range.setStartAfter(span);
                    range.setEndAfter(span);
                } else {
                    try {
                        range.surroundContents(span);
                    } catch (e) {
                        // If selection can't be surrounded, insert at cursor
                        span.innerHTML = '&nbsp;';
                        range.insertNode(span);
                        range.setStartAfter(span);
                        range.setEndAfter(span);
                    }
                }
                
                selection.removeAllRanges();
                selection.addRange(range);
            }

            applyBackgroundColor(color) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.className = `notion-bg-${color}`;
                
                if (range.collapsed) {
                    span.innerHTML = '&nbsp;';
                    range.insertNode(span);
                    range.setStartAfter(span);
                    range.setEndAfter(span);
                } else {
                    try {
                        range.surroundContents(span);
                    } catch (e) {
                        span.innerHTML = '&nbsp;';
                        range.insertNode(span);
                        range.setStartAfter(span);
                        range.setEndAfter(span);
                    }
                }
                
                selection.removeAllRanges();
                selection.addRange(range);
            }

            convertCurrentBlock(type) {
                if (this.currentBlock) {
                    this.convertBlock(this.currentBlock.id, type);
                }
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Global shortcuts
                    if (e.key === '/' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        if (this.currentBlock) {
                            this.showBlockTypeSelector(
                                document.querySelector(`[data-id="${this.currentBlock.id}"] .notion-block-content`),
                                this.currentBlock.id
                            );
                        }
                    }
                    
                    // Escape closes menus
                    if (e.key === 'Escape') {
                        document.getElementById('notionToolbar').style.display = 'none';
                        document.getElementById('notionTypeSelector').style.display = 'none';
                        document.getElementById('textColorDropdown').style.display = 'none';
                        document.getElementById('bgColorDropdown').style.display = 'none';
                    }
                });
            }

            setupFormatting() {
                // Color pickers are already set up in setupEventListeners
            }

            setupBlockSelector() {
                // Already set up in setupEventListeners
            }

            setupAutoSave() {
                setInterval(() => {
                    this.saveToLocalStorage();
                }, 5000); // Auto-save every 5 seconds
            }

            // ============================
            // HISTORY MANAGEMENT
            // ============================

            saveHistory() {
                const state = {
                    blocks: JSON.parse(JSON.stringify(this.blocks)),
                    pageTitle: document.getElementById('pageTitle').value
                };
                
                this.history = this.history.slice(0, this.historyIndex + 1);
                this.history.push(state);
                this.historyIndex++;
                
                // Keep last 50 states
                if (this.history.length > 50) {
                    this.history.shift();
                    this.historyIndex--;
                }
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.restoreState(this.history[this.historyIndex]);
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.restoreState(this.history[this.historyIndex]);
                }
            }

            restoreState(state) {
                // Clear current blocks
                this.blocks = state.blocks;
                const editor = document.getElementById('notionEditor');
                editor.innerHTML = '';
                
                // Restore blocks
                state.blocks.forEach((block, index) => {
                    this.renderBlock(block, index);
                });
                
                // Restore page title
                document.getElementById('pageTitle').value = state.pageTitle;
            }

            // ============================
            // PERSISTENCE
            // ============================

            saveToLocalStorage() {
                const data = {
                    title: document.getElementById('pageTitle').value,
                    blocks: this.blocks,
                    timestamp: Date.now()
                };
                
                localStorage.setItem('notion-editor-data', JSON.stringify(data));
            }

            loadFromLocalStorage() {
                const saved = localStorage.getItem('notion-editor-data');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        document.getElementById('pageTitle').value = data.title;
                        
                        // Clear current blocks
                        this.blocks = [];
                        document.getElementById('notionEditor').innerHTML = '';
                        
                        // Load saved blocks
                        data.blocks.forEach((block, index) => {
                            this.addBlock(block.type, block.content, index, block);
                        });
                    } catch (e) {
                        console.error('Failed to load saved data:', e);
                    }
                }
            }

            // ============================
            // UTILITY METHODS
            // ============================

            showContextMenu(e, blockId) {
                // Simple context menu implementation
                const menu = document.createElement('div');
                menu.className = 'notion-toolbar';
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                menu.innerHTML = `
                    <div class="notion-toolbar-group">
                        <button class="notion-toolbar-button" data-action="cut">Cut</button>
                        <button class="notion-toolbar-button" data-action="copy">Copy</button>
                        <button class="notion-toolbar-button" data-action="paste">Paste</button>
                    </div>
                `;
                
                document.body.appendChild(menu);
                
                // Remove menu on click elsewhere
                setTimeout(() => {
                    const removeMenu = () => {
                        menu.remove();
                        document.removeEventListener('click', removeMenu);
                    };
                    document.addEventListener('click', removeMenu);
                }, 10);
            }

            showConvertMenu(blockId) {
                const blockElement = document.querySelector(`[data-id="${blockId}"]`);
                const rect = blockElement.getBoundingClientRect();
                
                this.showBlockTypeSelector(blockElement.querySelector('.notion-block-content'), blockId);
            }

            showEmojiPicker() {
                const emojis = ['üìÑ', 'üìù', 'üìã', 'üìä', 'üéØ', 'üí°', 'üöÄ', '‚≠ê', 'üî•', 'üíé', 'üé®', 'üîß', 'üìö', 'üéÆ', 'üçï'];
                const pageIcon = document.getElementById('pageIcon');
                
                // Simple emoji picker
                const picker = document.createElement('div');
                picker.className = 'notion-type-selector';
                picker.style.left = (pageIcon.getBoundingClientRect().left + window.scrollX) + 'px';
                picker.style.top = (pageIcon.getBoundingClientRect().bottom + window.scrollY + 5) + 'px';
                picker.style.width = '200px';
                
                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
                grid.style.gap = '8px';
                grid.style.padding = '16px';
                
                emojis.forEach(emoji => {
                    const button = document.createElement('button');
                    button.className = 'notion-toolbar-button';
                    button.style.width = '40px';
                    button.style.height = '40px';
                    button.style.fontSize = '20px';
                    button.textContent = emoji;
                    button.addEventListener('click', () => {
                        pageIcon.textContent = emoji;
                        document.body.removeChild(picker);
                    });
                    grid.appendChild(button);
                });
                
                picker.appendChild(grid);
                document.body.appendChild(picker);
                
                // Close on click outside
                setTimeout(() => {
                    const closePicker = (e) => {
                        if (!picker.contains(e.target) && e.target !== pageIcon) {
                            document.body.removeChild(picker);
                            document.removeEventListener('click', closePicker);
                        }
                    };
                    document.addEventListener('click', closePicker);
                }, 10);
            }

            addDatabaseRow(table) {
                const tbody = table.querySelector('tbody');
                const newRow = document.createElement('tr');
                newRow.className = 'notion-database-row';
                
                for (let i = 0; i < 4; i++) {
                    const td = document.createElement('td');
                    td.className = 'notion-database-cell';
                    const content = document.createElement('div');
                    content.className = 'notion-database-cell-content';
                    content.contentEditable = true;
                    td.appendChild(content);
                    newRow.appendChild(td);
                }
                
                tbody.appendChild(newRow);
                
                // Focus first cell
                setTimeout(() => {
                    newRow.querySelector('.notion-database-cell-content').focus();
                }, 10);
            }
        }

        // ============================
        // INITIALIZATION
        // ============================
        
        document.addEventListener('DOMContentLoaded', () => {
            window.notionEditor = new NotionEditorCore();
            
            // Load saved data
            window.notionEditor.loadFromLocalStorage();
            
            // Auto-save on beforeunload
            window.addEventListener('beforeunload', () => {
                window.notionEditor.saveToLocalStorage();
            });
            
            // Page title auto-resize
            const pageTitle = document.getElementById('pageTitle');
            pageTitle.style.height = 'auto';
            pageTitle.style.height = pageTitle.scrollHeight + 'px';
            
            // Initialize numbered lists
            window.notionEditor.updateNumberedLists();
            
            // Focus first block if empty
            setTimeout(() => {
                const firstBlock = document.querySelector('.notion-block-content');
                if (firstBlock && !firstBlock.textContent.trim()) {
                    firstBlock.focus();
                }
            }, 100);
        });
    </script>
</body>
</html>